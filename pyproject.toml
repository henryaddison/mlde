[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "ml_downscaling_emulator"
version = "0.3.0a1"
authors = [
  { name="Henry Addison", email="henry.addison@bristol.ac.uk" },
]
description = "A package for score-based generative models using SDEs for downscaling precipitation"
readme = "README.md"
requires-python = ">=3.7"
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: OS Independent",
]

dependencies = [
  "flufl-lock==7.1.1",
  "mlde-utils==0.2.0",
  "mlflow",
  #"python-cmethods==1.0.1",
  "tqdm", "torchinfo>=1.8.0,<2",
]

[dependency-groups]
test = ["pytest"]
dev = [{include-group = "test"}]

[project.urls]
"Homepage" = "https://github.com/henryaddison/mlde"
"Bug Tracker" = "https://github.com/henryaddison/mlde/issues"

[project.scripts]
    mlde = "ml_downscaling_emulator.bin:app"

[tool.black]
extend-exclude = '^/src/ml_downscaling_emulator/(run_lib.py|sde_lib.py|likelihood.py|sampling.py|losses.py|models|op|configs)'

[tool.pixi.workspace]
channels = ["pytorch", "nvidia", "conda-forge", "nodefaults"]
name = "mlde"
platforms = ["linux-64"]

[tool.pixi.system-requirements]
cuda = "11.7"

[tool.pixi.environments]
default = {features = [], solve-group = "default"}
dev = {features = ["dev"], solve-group = "default"}
# Create a custom environment which only has the `lint` feature
lint = {features = ["lint"], no-default-feature = true}

[tool.pixi.tasks]

[tool.pixi.dependencies]
absl-py = { version = "==1.3.0", build = "pyhd8ed1ab_0" }
bottleneck = { version = "==1.3.5", build = "py39h2ae25f5_1" }
cdo = { version = "==2.1.0", build = "h15029e1_0" }
codetiming = { version = "==1.4.0", build = "pyhd8ed1ab_0" }
cuda = { version = "==11.7" }
dask = { version = "==2022.12.1", build = "pyhd8ed1ab_0" }
filelock = { version = "==3.8.2", build = "pyhd8ed1ab_0" }
gxx = { version = "==8.5.0", build = "h143be6b_10" }
iris = { version = "==3.4.0", build = "pyhd8ed1ab_0" }
knockknock = { version = "==0.1.8.1", build = "py_0" }
metpy = { version = "==1.3.1", build = "pyhd8ed1ab_0" }
ml-collections = { version = "==0.1.1", build = "pyhd8ed1ab_0" }
mkl = { version = "<=2024.0" }
netcdf4 = { version = "*" }
ninja = { version = "==1.11.0", build = "h924138e_0" }
pint = { version = "==0.20.1", build = "pyhd8ed1ab_0" }
pip = { version = "==22.3.1", build = "pyhd8ed1ab_0" }
python = { version = "==3.9.15", build = "hba424b6_0_cpython" }
python-cdo = { version = "==1.5.7", build = "pyhd8ed1ab_0" }
python-dotenv = { version = "==1.0.1", build = "pyhd8ed1ab_0" }
pytorch = { version = "==1.13.1" }
pytorch-cuda = { version = "==11.7" }
shortuuid = { version = "==1.0.11", build = "pyhd8ed1ab_0" }
tensorboard = { version = "==2.11.0", build = "pyhd8ed1ab_0" }
torchaudio = { version = "==0.13.1" }
torchvision = { version = "==0.14.1" }
typer = { version = "==0.7.0", build = "pyhd8ed1ab_0" }
wandb = { version = "==0.13.7", build = "pyhd8ed1ab_0" }
xarray = { version = "==2022.12.0", build = "pyhd8ed1ab_0" }

[tool.pixi.pypi-dependencies]
ml-downscaling-emulator = { path = ".", editable = true }

[tool.pixi.feature.lint.dependencies]
python = { version = "==3.9.15" }
pre-commit = "*"
flake8 = { version = "==6.0.0" }
black = { version = "==22.10.0" }

[tool.pixi.feature.dev.tasks]
test = "pytest"

[tool.pixi.feature.lint.tasks]
lint = "black . && flake8 ."
